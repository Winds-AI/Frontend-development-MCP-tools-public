<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Autonomous Frontend Browser Tools — Enhanced Setup</title>
    <style>
      :root {
        --bg: #0f172a;
        --panel: #1e293b;
        --panel-hover: #334155;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border: #334155;
        --accent-primary: #3b82f6;
        --accent-secondary: #60a5fa;
        --accent-tertiary: #1e40af;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        --info: #0ea5e9;
        --header-h: 70px;
        --footer-h: 45px;
        --transition: all 0.2s ease;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        font-size: 15px;
        line-height: 1.6;
        background: var(--bg);
        color: var(--text-primary);
      }

      header {
        padding: 12px clamp(16px, 2vw, 32px);
        background: #111827;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        height: var(--header-h);
      }

      h1 {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0;
        letter-spacing: -0.02em;
      }

      nav {
        display: flex;
        gap: 8px;
      }

      nav button {
        background: transparent;
        color: var(--text-secondary);
        border: 0;
        padding: 10px 14px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: var(--transition);
      }

      nav button.active,
      nav button:hover {
        background: var(--panel-hover);
        color: var(--text-primary);
      }

      .top-actions {
        display: flex;
        gap: 12px;
      }

      .action-button {
        text-decoration: none;
        padding: 10px 14px;
        border-radius: 8px;
        background: var(--panel);
        color: var(--text-primary);
        border: 1px solid var(--border);
        cursor: pointer;
        font-weight: 500;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .action-button:hover {
        background: var(--panel-hover);
        border-color: var(--accent-primary);
      }

      .action-button.primary {
        background: var(--accent-primary);
        border-color: var(--accent-primary);
      }

      .action-button.primary:hover {
        background: var(--accent-secondary);
        border-color: var(--accent-secondary);
      }

      main {
        padding: 20px clamp(16px, 2vw, 32px);
        width: 100%;
        box-sizing: border-box;
        min-height: calc(100dvh - var(--header-h) - var(--footer-h));
      }

      .section {
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .row {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        flex: 1;
        min-width: 300px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
      }

      .card:hover {
        border-color: var(--accent-primary);
      }

      .card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
      }

      .card-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--accent-tertiary);
        color: white;
      }

      .card h3 {
        font-size: 1.25rem;
        margin: 0;
        font-weight: 600;
      }

      textarea {
        width: 100%;
        height: 55vh;
        background: #0b1220;
        color: var(--text-primary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 14px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          monospace;
        font-size: 13px;
        resize: vertical;
        transition: var(--transition);
      }

      textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
      }

      .actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        flex-wrap: wrap;
      }

      button {
        background: var(--accent-primary);
        color: white;
        border: 0;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: var(--transition);
      }

      button:hover {
        background: var(--accent-secondary);
        transform: translateY(-1px);
      }

      button.secondary {
        background: var(--panel);
        color: var(--text-primary);
        border: 1px solid var(--border);
      }

      button.secondary:hover {
        background: var(--panel-hover);
        border-color: var(--accent-primary);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .hint {
        color: var(--text-muted);
        font-size: 13px;
        margin-top: 8px;
      }

      .hint.small {
        font-size: 12px;
      }

      .success {
        color: var(--success);
      }

      .error {
        color: var(--error);
      }

      .warning {
        color: var(--warning);
      }

      .info {
        color: var(--info);
      }

      .invalid {
        border-color: var(--error) !important;
        box-shadow: 0 0 0 1px var(--error) inset;
      }

      footer {
        padding: 16px clamp(16px, 2vw, 32px);
        color: var(--text-muted);
        font-size: 13px;
        border-top: 1px solid var(--border);
        height: var(--footer-h);
      }

      .split {
        display: flex;
        gap: 20px;
        height: calc(100dvh - var(--header-h) - var(--footer-h) - 40px);
      }

      .left {
        width: clamp(420px, 40vw, 700px);
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-height: calc(100vh - var(--header-h) - var(--footer-h) - 40px);
      }

      /* Redesigned sidebar styles */
      .sidebar-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 8px;
      }

      .sidebar-subtle {
        color: var(--text-muted);
        font-size: 12px;
      }

      .project-controls {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
        margin-bottom: 12px;
      }

      .small-btn {
        padding: 6px 10px;
        border-radius: 6px;
        background: var(--panel);
        color: var(--text-primary);
        border: 1px solid var(--border);
        cursor: pointer;
      }

      .small-btn:hover {
        background: var(--panel-hover);
        border-color: var(--accent-primary);
      }

      .project-list {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 12px;
      }

      .project-item {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
        padding: 8px 10px;
        border: 1px solid var(--border);
        border-radius: 8px;
        cursor: pointer;
      }

      .project-item:hover {
        background: var(--panel-hover);
      }

      .project-item.active {
        border-color: var(--accent-primary);
        background: rgba(59, 130, 246, 0.08);
      }

      .project-name {
        font-weight: 600;
      }

      .project-meta {
        display: inline-flex;
        gap: 6px;
        align-items: center;
      }

      .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
      }

      .dot.ok {
        background: var(--success);
      }
      .dot.warn {
        background: var(--warning);
      }
      .dot.fail {
        background: var(--error);
      }

      .section-title {
        margin: 12px 0 6px 0;
        font-weight: 600;
      }

      .inline-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin: 4px 0 10px 0;
      }

      .inline-actions .small-btn {
        font-size: 12px;
      }

      .two-col {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      @media (max-width: 1200px) {
        .two-col {
          grid-template-columns: 1fr;
        }
      }

      /* Redesigned Reference panel */
      .reference details {
        border: 1px solid var(--border);
        border-radius: 10px;
        overflow: hidden;
      }

      .reference summary {
        list-style: none;
        cursor: pointer;
        padding: 12px 14px;
        background: rgba(59, 130, 246, 0.08);
        border-bottom: 1px solid var(--border);
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .reference summary::-webkit-details-marker {
        display: none;
      }

      .ref-panel {
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .ref-section {
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        background: rgba(0, 0, 0, 0.12);
      }
      .ref-header {
        padding: 12px 16px;
        background: rgba(59, 130, 246, 0.1);
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .ref-items {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 12px;
      }
      .ref-item {
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 12px;
        background: rgba(0, 0, 0, 0.08);
      }
      .ref-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }
      .ref-key {
        font-weight: 700;
        letter-spacing: 0.02em;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          monospace;
      }
      .ref-chips {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      .chip {
        display: inline-flex;
        align-items: center;
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        font-size: 12px;
        font-weight: 500;
        white-space: nowrap;
      }
      .chip-primary {
        background: rgba(59, 130, 246, 0.15);
        color: var(--accent-primary);
        border-color: var(--accent-primary);
      }
      .chip-warning {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
        border-color: var(--warning);
      }
      .chip-success {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
        border-color: var(--success);
      }
      .chip-secondary {
        background: rgba(148, 163, 184, 0.15);
        color: var(--text-muted);
        border-color: var(--text-muted);
      }
      .chip-required {
        background: rgba(239, 68, 68, 0.12);
        color: var(--error);
        border-color: var(--error);
      }
      .chip-optional {
        background: rgba(14, 165, 233, 0.12);
        color: var(--info);
        border-color: var(--info);
      }
      .ref-desc {
        margin-top: 8px;
        color: var(--text-secondary);
        line-height: 1.5;
        overflow-wrap: anywhere;
      }
      .ref-example {
        margin-top: 8px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          monospace;
        font-size: 12px;
        background: rgba(0, 0, 0, 0.2);
        padding: 6px 8px;
        border-radius: 6px;
        color: var(--accent-secondary);
      }

      .right {
        flex: 1;
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        /* Use internal editor scroll; avoid double-scroll on container */
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        max-height: calc(100vh - var(--header-h) - var(--footer-h) - 40px);
        /* Important: allow flex children to shrink properly */
        min-height: 0;
        min-width: 340px;
      }

      .file {
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        transition: var(--transition);
      }

      .file:hover {
        background: var(--panel-hover);
      }

      .badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 999px;
        font-size: 12px;
        margin-left: 8px;
        border: 1px solid var(--border);
        font-weight: 500;
      }

      .ok {
        color: var(--success);
        border-color: var(--success);
      }

      .warn {
        color: var(--warning);
        border-color: var(--warning);
      }

      .fail {
        color: var(--error);
        border-color: var(--error);
      }

      .example-header {
        margin-bottom: 16px;
      }

      .example-header h4 {
        margin-bottom: 4px;
      }

      .example-note {
        padding: 16px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
      }

      .editor-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        margin: 16px 0;
        min-height: 0;
      }

      textarea.config-textarea {
        flex: 1;
        min-height: 400px;
        height: 100%;
        max-height: none;
        resize: none;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 13px;
        line-height: 1.5;
      }

      /* Monaco Editor host */
      #projects-editor {
        flex: 1;
        min-height: 400px;
        height: 100%;
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
        background: #0b1220;
      }

      /* Validation highlight for editor */
      .editor-invalid #projects-editor {
        border-color: var(--error) !important;
        box-shadow: 0 0 0 1px var(--error) inset;
      }

      .examples-container {
        display: flex;
        gap: 24px;
        margin-bottom: 20px;
      }

      .example-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .example-header {
        margin-bottom: 16px;
      }

      .example-header h4 {
        margin: 0 0 8px 0;
        color: var(--accent-primary);
        font-size: 1.1rem;
        font-weight: 600;
      }

      .example-header .hint {
        margin: 0;
        color: var(--text-secondary);
      }

      .example-code {
        background: #0b1220;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 16px;
        margin: 16px 0;
        overflow: auto;
        max-height: 300px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          monospace;
        font-size: 13px;
        line-height: 1.4;
        color: var(--accent-secondary);
      }

      .example-actions {
        margin-top: 16px;
        text-align: center;
      }

      .example-actions button {
        background: var(--accent-primary);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 16px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .example-actions button:hover {
        background: var(--accent-secondary);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }

      .example-note {
        margin-top: 24px;
        padding: 16px;
        background: rgba(59, 130, 246, 0.05);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 8px;
        text-align: center;
      }

      .example-note .hint {
        margin: 0;
        color: var(--text-secondary);
      }

      @media (max-width: 900px) {
        .examples-container {
          flex-direction: column;
          gap: 20px;
        }

        .example-column {
          padding: 16px;
        }
      }

      @media (max-width: 600px) {
        .example-actions button {
          width: 100%;
          justify-content: center;
        }
      }

      .config-search-container {
        position: relative;
        margin: 16px 0;
      }

      .config-search-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: #0b1220;
        color: var(--text-primary);
        font-size: 14px;
        transition: var(--transition);
      }

      .config-search-input:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
      }

      .clear-search-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: transparent;
        border: none;
        color: var(--text-muted);
        font-size: 18px;
        cursor: pointer;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .clear-search-btn:hover {
        background: var(--panel-hover);
        color: var(--text-primary);
      }

      #docs-search {
        background: #0b1220;
        color: var(--text-primary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 10px 12px;
        margin-bottom: 12px;
        font-size: 14px;
        width: 100%;
        transition: var(--transition);
      }

      #docs-search:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
      }

      #docs-items {
        overflow: auto;
      }

      #docs-view h1,
      #docs-view h2,
      #docs-view h3 {
        margin-top: 1em;
        margin-bottom: 0.5em;
      }

      #docs-view h1 {
        font-size: 1.75rem;
        border-bottom: 1px solid var(--border);
        padding-bottom: 0.3em;
      }

      /* Configuration Guide Styles */
      .config-category {
        margin-bottom: 24px;
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden; /* Keep this to contain children */
      }

      .category-header {
        background: rgba(59, 130, 246, 0.1);
        padding: 12px 16px;
        border-bottom: 1px solid var(--border);
      }

      .category-header h4 {
        margin: 0 0 4px 0;
        color: var(--accent-primary);
        font-size: 1.1rem;
      }

      .config-items {
        padding: 0;
      }

      .config-item {
        display: grid;
        grid-template-columns: 1fr auto; /* Name and badge */
        align-items: start;
        gap: 8px 16px;
        padding: 16px;
        border-bottom: 1px solid var(--border);
      }

      .config-item:last-child {
        border-bottom: none;
      }

      .config-name {
        font-weight: 600;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          monospace;
        grid-column: 1 / 2;
        padding-top: 2px;
      }

      .config-badges {
        grid-column: 2 / 3;
        text-align: right;
      }

      .config-description {
        grid-column: 1 / 3;
        margin-top: 8px;
        padding-left: 16px;
        border-left: 2px solid var(--accent-tertiary);
      }

      .config-example {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          monospace;
        font-size: 12px;
        background: rgba(0, 0, 0, 0.2);
        padding: 6px 8px;
        border-radius: 4px;
        margin-top: 8px;
        color: var(--accent-secondary);
      }

      .badge.primary {
        background: rgba(59, 130, 246, 0.15);
        color: var(--accent-primary);
        border-color: var(--accent-primary);
      }

      .badge.warning {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
        border-color: var(--warning);
      }

      .badge.info {
        background: rgba(14, 165, 233, 0.15);
        color: var(--info);
        border-color: var(--info);
      }

      .badge.success {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
        border-color: var(--success);
      }

      .badge.secondary {
        background: rgba(148, 163, 184, 0.15);
        color: var(--text-muted);
        border-color: var(--text-muted);
      }

      .config-note {
        margin-top: 24px;
        padding: 16px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
      }

      .config-guide-container {
        flex: 1;
        overflow-y: auto;
        margin-top: 16px;
        padding-right: 8px;
      }

      /* Custom scrollbar for Webkit browsers */
      .config-guide-container::-webkit-scrollbar {
        width: 8px;
      }

      .config-guide-container::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 4px;
      }

      .config-guide-container::-webkit-scrollbar-thumb {
        background: var(--accent-primary);
        border-radius: 4px;
      }

      .config-guide-container::-webkit-scrollbar-thumb:hover {
        background: var(--accent-secondary);
      }

      .editor-header {
        margin-bottom: 16px;
      }

      .editor-header h3 {
        margin-top: 0;
      }

      .editor-header p {
        margin: 8px 0 0 0;
        color: var(--text-secondary);
      }

      #docs-view h2 {
        font-size: 1.5rem;
      }

      #docs-view h3 {
        font-size: 1.25rem;
      }

      #docs-view code,
      #docs-view pre {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          monospace;
      }

      #docs-view code {
        background: #0b1220;
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 2px 6px;
      }

      #docs-view pre {
        background: #0b1220;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 16px;
        overflow: auto;
        line-height: 1.5;
        word-break: normal;
        white-space: pre;
      }

      #docs-view pre code {
        background: transparent;
        border: none;
        padding: 0;
        display: block;
        line-height: inherit;
        white-space: inherit;
      }

      #docs-view a {
        color: var(--accent-primary);
        text-decoration: none;
      }

      #docs-view a:hover {
        text-decoration: underline;
      }

      #docs-view ul,
      #docs-view ol {
        padding-left: 1.5em;
      }

      #docs-view li {
        margin-bottom: 0.5em;
      }

      .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-indicator.ok {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
      }

      .status-indicator.warning {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
      }

      .status-indicator.error {
        background: rgba(239, 68, 68, 0.15);
        color: var(--error);
      }

      .status-indicator.info {
        background: rgba(14, 165, 233, 0.15);
        color: var(--info);
      }

      .progress-bar {
        height: 6px;
        background: var(--panel-hover);
        border-radius: 3px;
        overflow: hidden;
        margin: 12px 0;
      }

      .progress-fill {
        height: 100%;
        background: var(--accent-primary);
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
      }

      .dashboard-card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .dashboard-card h3 {
        margin-top: 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .dashboard-card .status {
        margin: 12px 0;
        padding: 12px;
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.2);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 500;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: #0b1220;
        color: var(--text-primary);
        font-size: 14px;
        transition: var(--transition);
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--panel-hover);
        transition: 0.4s;
        border-radius: 24px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: var(--accent-primary);
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      .toggle-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      @media (max-width: 900px) {
        .split {
          flex-direction: column;
          height: auto;
        }

        .left {
          width: 100%;
          height: auto;
          max-height: 40dvh;
        }

        .right {
          width: 100%;
          height: auto;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 600px) {
        header {
          flex-direction: column;
          gap: 12px;
          height: auto;
        }

        .top-actions {
          width: 100%;
          justify-content: center;
        }

        nav {
          flex-wrap: wrap;
          justify-content: center;
        }
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <!-- Monaco Editor Loader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
    <script>
      const AFBT_LAUNCHED_BY_MAIN = /*AFBT_LAUNCHED_BY_MAIN_PLACEHOLDER*/ false;
      let activeTab = "dashboard";
      let DOCS_FILES = [];
      let __serverInfoCache = null;
      let projectsEditor = null; // Monaco instance when available

      function getProjectsText() {
        const ta = document.getElementById("projects");
        if (projectsEditor && typeof projectsEditor.getValue === "function") {
          return projectsEditor.getValue();
        }
        return ta ? ta.value : "";
      }

      function setProjectsText(text) {
        const ta = document.getElementById("projects");
        if (projectsEditor && typeof projectsEditor.setValue === "function") {
          // Only set if different to avoid resetting cursor/undo stack too often
          if (projectsEditor.getValue() !== text) projectsEditor.setValue(text);
        } else if (ta) {
          ta.value = text;
        }
      }

      // Enhanced UI functions
      async function loadConfig() {
        try {
          const res = await fetch("/config");
          if (!res.ok) throw new Error("Failed to load config");
          const json = await res.json();
          setProjectsText(JSON.stringify(json, null, 2));
          setStatus("Loaded current configuration.", "success");

          // Update form-based configuration if available
          updateFormConfig(json);
        } catch {
          setProjectsText("");
          setStatus(
            "No projects.json found. Open the Examples tab to copy a template, then paste here and Save.",
            "warning"
          );
        }
        await reloadEnv();
      }

      // ===== Sidebar state and binding helpers =====
      const __afbtState = { selectedProject: null, debounce: null };

      function parseEditorJsonSafe() {
        try {
          const txt = getProjectsText() || "{}";
          const j = JSON.parse(txt);
          if (!j || typeof j !== "object") return { projects: {} };
          if (!j.projects || typeof j.projects !== "object") j.projects = {};
          return j;
        } catch {
          return { projects: {} };
        }
      }

      function stringifyAndSetProjects(j) {
        try {
          setProjectsText(JSON.stringify(j, null, 2));
          updateEditorValidation();
        } catch {}
      }

      function chooseSelectedProject(j) {
        const names = Object.keys(j.projects || {});
        if (!names.length) return null;
        if (
          __afbtState.selectedProject &&
          j.projects[__afbtState.selectedProject]
        )
          return __afbtState.selectedProject;
        if (
          typeof j.defaultProject === "string" &&
          j.projects[j.defaultProject]
        )
          return j.defaultProject;
        return names[0];
      }

      function computeProjectHealth(cfg) {
        const swaggerOk = !!(cfg && cfg.SWAGGER_URL);
        const apiOk = !!(cfg && cfg.API_BASE_URL);
        if (swaggerOk && apiOk) return "ok";
        if (swaggerOk || apiOk) return "warn";
        return "fail";
      }

      function renderProjectList(j) {
        const list = document.getElementById("project-list");
        if (!list) return;
        list.innerHTML = "";
        const names = Object.keys(j.projects || {});
        if (!names.length) {
          const empty = document.createElement("div");
          empty.className = "hint";
          empty.textContent = "No projects yet. Add one to get started.";
          list.appendChild(empty);
          return;
        }
        names.forEach((name) => {
          const item = document.createElement("div");
          item.className =
            "project-item" +
            (name === __afbtState.selectedProject ? " active" : "");
          const metaDiv = document.createElement("div");
          metaDiv.className = "project-meta";
          const isDefault = j.defaultProject === name;
          const cfg = (j.projects[name] && j.projects[name].config) || {};
          const health = computeProjectHealth(cfg);
          metaDiv.innerHTML = `${
            isDefault ? '<span title="Default">⭐</span>' : ""
          } <span class=\"dot ${health}\"></span>`;
          const nm = document.createElement("div");
          nm.className = "project-name";
          nm.textContent = name;
          item.appendChild(nm);
          item.appendChild(metaDiv);
          item.onclick = () => {
            __afbtState.selectedProject = name;
            renderSidebarFromEditor();
          };
          list.appendChild(item);
        });
      }

      function setInputValue(id, v) {
        const el = document.getElementById(id);
        if (!el) return;
        el.value = v == null ? "" : String(v);
      }

      function setSelectValue(id, v) {
        const el = document.getElementById(id);
        if (!el) return;
        el.value = v == null ? "" : String(v);
      }

      function markFieldValidity(id, valid) {
        const el = document.getElementById(id);
        if (!el) return;
        if (valid) el.classList.remove("invalid");
        else el.classList.add("invalid");
      }

      function renderProjectForm(j) {
        const label = document.getElementById("current-project-label");
        const actions = document.getElementById("selected-project-actions");
        const form = document.getElementById("project-form");
        const name = __afbtState.selectedProject;
        if (!name || !j.projects[name]) {
          if (label) label.textContent = "No project selected";
          if (actions) actions.style.display = "none";
          if (form) form.style.display = "none";
          return;
        }
        const cfg = (j.projects[name] && j.projects[name].config) || {};
        if (label) label.textContent = name;
        if (actions) actions.style.display = "flex";
        if (form) form.style.display = "block";
        setInputValue("fld-SWAGGER_URL", cfg.SWAGGER_URL || "");
        setInputValue("fld-API_BASE_URL", cfg.API_BASE_URL || "");
        setSelectValue("fld-AUTH_STORAGE_TYPE", cfg.AUTH_STORAGE_TYPE || "");
        setInputValue("fld-AUTH_TOKEN_KEY", cfg.AUTH_TOKEN_KEY || "");
        setInputValue("fld-AUTH_ORIGIN", cfg.AUTH_ORIGIN || "");
        setInputValue(
          "fld-API_AUTH_TOKEN_TTL_SECONDS",
          cfg.API_AUTH_TOKEN_TTL_SECONDS || ""
        );
        setInputValue("fld-ROUTES_FILE_PATH", cfg.ROUTES_FILE_PATH || "");
        setInputValue(
          "fld-SCREENSHOT_STORAGE_PATH",
          cfg.SCREENSHOT_STORAGE_PATH || ""
        );
        setInputValue(
          "fld-DEFAULT_SCREENSHOT_STORAGE_PATH",
          j.DEFAULT_SCREENSHOT_STORAGE_PATH || ""
        );
        // validity cues
        markFieldValidity("fld-SWAGGER_URL", !!cfg.SWAGGER_URL);
        markFieldValidity("fld-API_BASE_URL", !!cfg.API_BASE_URL);
      }

      function renderSidebarFromEditor(preParsed) {
        const j = preParsed || parseEditorJsonSafe();
        __afbtState.selectedProject = chooseSelectedProject(j);
        renderProjectList(j);
        renderProjectForm(j);
      }

      function debouncedRender() {
        try {
          clearTimeout(__afbtState.debounce);
        } catch {}
        __afbtState.debounce = setTimeout(() => renderSidebarFromEditor(), 200);
      }

      function bindFormInputs() {
        const bindText = (id, key, isNumber) => {
          const el = document.getElementById(id);
          if (!el) return;
          el.addEventListener("input", () => {
            const j = parseEditorJsonSafe();
            const name = __afbtState.selectedProject;
            if (!name) return;
            const proj =
              j.projects[name] || (j.projects[name] = { config: {} });
            const cfg = proj.config || (proj.config = {});
            const raw = el.value.trim();
            if (!raw) {
              delete cfg[key];
            } else {
              cfg[key] = isNumber ? Number(raw) : raw;
            }
            stringifyAndSetProjects(j);
            renderSidebarFromEditor(j);
          });
        };
        bindText("fld-SWAGGER_URL", "SWAGGER_URL");
        bindText("fld-API_BASE_URL", "API_BASE_URL");
        bindText("fld-AUTH_TOKEN_KEY", "AUTH_TOKEN_KEY");
        bindText("fld-AUTH_ORIGIN", "AUTH_ORIGIN");
        bindText(
          "fld-API_AUTH_TOKEN_TTL_SECONDS",
          "API_AUTH_TOKEN_TTL_SECONDS",
          true
        );
        bindText("fld-ROUTES_FILE_PATH", "ROUTES_FILE_PATH");
        bindText("fld-SCREENSHOT_STORAGE_PATH", "SCREENSHOT_STORAGE_PATH");
        // Global (top-level)
        const g = document.getElementById(
          "fld-DEFAULT_SCREENSHOT_STORAGE_PATH"
        );
        if (g)
          g.addEventListener("input", () => {
            const j = parseEditorJsonSafe();
            const raw = g.value.trim();
            if (!raw) delete j.DEFAULT_SCREENSHOT_STORAGE_PATH;
            else j.DEFAULT_SCREENSHOT_STORAGE_PATH = raw;
            stringifyAndSetProjects(j);
            renderSidebarFromEditor(j);
          });
        const st = document.getElementById("fld-AUTH_STORAGE_TYPE");
        if (st)
          st.addEventListener("change", () => {
            const j = parseEditorJsonSafe();
            const name = __afbtState.selectedProject;
            if (!name) return;
            const proj =
              j.projects[name] || (j.projects[name] = { config: {} });
            const cfg = proj.config || (proj.config = {});
            const val = st.value;
            if (!val) delete cfg.AUTH_STORAGE_TYPE;
            else cfg.AUTH_STORAGE_TYPE = val;
            stringifyAndSetProjects(j);
            renderSidebarFromEditor(j);
          });
      }

      function bindProjectActions() {
        const addBtn = document.getElementById("btn-project-add");
        const addInput = document.getElementById("project-add-input");
        if (addBtn && addInput) {
          addBtn.addEventListener("click", () => {
            const name = (addInput.value || "").trim();
            if (!name) return setStatus("Enter a project name.", "warning");
            const j = parseEditorJsonSafe();
            if (j.projects[name])
              return setStatus("Project already exists.", "warning");
            j.projects[name] = { config: {} };
            if (!j.defaultProject) j.defaultProject = name;
            __afbtState.selectedProject = name;
            stringifyAndSetProjects(j);
            addInput.value = "";
            setStatus("Project added.", "success");
            renderSidebarFromEditor(j);
          });
        }
        const setDefaultBtn = document.getElementById("btn-set-default");
        if (setDefaultBtn)
          setDefaultBtn.addEventListener("click", () => {
            const j = parseEditorJsonSafe();
            if (!__afbtState.selectedProject) return;
            j.defaultProject = __afbtState.selectedProject;
            stringifyAndSetProjects(j);
            setStatus("Default project set.", "success");
            renderSidebarFromEditor(j);
          });
        const renameBtn = document.getElementById("btn-rename-project");
        if (renameBtn)
          renameBtn.addEventListener("click", () => {
            const j = parseEditorJsonSafe();
            const oldName = __afbtState.selectedProject;
            if (!oldName) return;
            const nn = prompt("New project name", oldName) || "";
            const newName = nn.trim();
            if (!newName || newName === oldName) return;
            if (j.projects[newName])
              return setStatus(
                "A project with that name already exists.",
                "error"
              );
            j.projects[newName] = j.projects[oldName];
            delete j.projects[oldName];
            if (j.defaultProject === oldName) j.defaultProject = newName;
            __afbtState.selectedProject = newName;
            stringifyAndSetProjects(j);
            setStatus("Project renamed.", "success");
            renderSidebarFromEditor(j);
          });
        const deleteBtn = document.getElementById("btn-delete-project");
        if (deleteBtn)
          deleteBtn.addEventListener("click", () => {
            const j = parseEditorJsonSafe();
            const name = __afbtState.selectedProject;
            if (!name) return;
            if (
              !confirm(
                `Delete project "${name}"? This only affects projects.json.`
              )
            )
              return;
            delete j.projects[name];
            if (j.defaultProject === name)
              j.defaultProject = Object.keys(j.projects)[0] || undefined;
            __afbtState.selectedProject = chooseSelectedProject(j);
            stringifyAndSetProjects(j);
            setStatus("Project deleted.", "success");
            renderSidebarFromEditor(j);
          });
      }

      function updateFormConfig(json) {
        try {
          // Initial render from loaded JSON
          renderSidebarFromEditor(json || parseEditorJsonSafe());
        } catch {}
      }

      function setStatus(msg, cls) {
        const el = document.getElementById("status");
        if (el) {
          el.textContent = msg;
          el.className = cls || "";
        }

        // Also update any tab-specific status elements
        const tabStatus = document.getElementById("tab-status");
        if (tabStatus) {
          tabStatus.textContent = msg;
          tabStatus.className = cls || "";
        }
      }

      function setButtonActive(id) {
        for (const b of document.querySelectorAll("nav button"))
          b.classList.remove("active");
        const activeBtn = document.getElementById(id);
        if (activeBtn) activeBtn.classList.add("active");
      }

      function showTab(tab) {
        activeTab = tab;
        for (const s of document.querySelectorAll(".section"))
          s.style.display = "none";
        const section = document.getElementById("section-" + tab);
        if (section) section.style.display = "block";
        setButtonActive("tab-" + tab);

        // Load content specific to the tab
        switch (tab) {
          case "docs":
            loadDocs();
            break;
          case "dashboard":
            refreshDashboard();
            break;
          case "env":
            reloadEnv();
            break;
          case "embed":
            loadEmbeddingsUi();
            break;
        }
      }

      async function getServerBaseUrl() {
        if (!__serverInfoCache) {
          try {
            const res = await fetch("/server/info");
            __serverInfoCache = await res.json();
          } catch {}
        }
        const p = __serverInfoCache && __serverInfoCache.port;
        return p ? "http://127.0.0.1:" + p : null;
      }

      function getProjectsFromEditor() {
        try {
          const txt = getProjectsText() || "{}";
          const j = JSON.parse(txt);
          return Object.keys(j.projects || {});
        } catch {
          return [];
        }
      }

      async function loadEmbeddingsUi() {
        try {
          const listEl = document.getElementById("embed-projects-list-ui");
          if (!listEl) return;
          listEl.innerHTML =
            '<div class="hint">Loading embeddings status...</div>';

          const projects = getProjectsFromEditor();
          const base = await getServerBaseUrl();

          if (projects.length === 0) {
            listEl.innerHTML =
              '<div class="hint">No projects configured. Add projects in the Configure tab first.</div>';
            return;
          }

          listEl.innerHTML = "";

          projects.forEach((name) => {
            const row = document.createElement("div");
            row.className = "card";
            row.style.marginBottom = "16px";

            const title = document.createElement("h3");
            title.textContent = name;
            title.style.marginTop = "0";

            const status = document.createElement("div");
            status.id = "embed-status-ui-" + name;
            status.textContent = base ? "Checking..." : "Server not detected";
            status.className = "hint";

            const actions = document.createElement("div");
            actions.className = "actions";

            const refreshBtn = document.createElement("button");
            refreshBtn.className = "secondary";
            refreshBtn.innerHTML = "<i>↻</i> Refresh";
            refreshBtn.onclick = () => refreshProjectStatusUi(name);

            const reindexBtn = document.createElement("button");
            reindexBtn.className = "primary";
            reindexBtn.innerHTML = "<i>↺</i> Reindex";
            reindexBtn.onclick = () => reindexProjectUi(name, reindexBtn);

            actions.appendChild(refreshBtn);
            actions.appendChild(reindexBtn);

            row.appendChild(title);
            row.appendChild(status);
            row.appendChild(actions);

            listEl.appendChild(row);
            if (base) refreshProjectStatusUi(name);
          });
        } catch (e) {
          const listEl = document.getElementById("embed-projects-list-ui");
          if (listEl) {
            listEl.innerHTML =
              '<div class="error">Failed to load embeddings UI: ' +
              (e.message || e) +
              "</div>";
          }
        }
      }

      async function refreshProjectStatusUi(project) {
        const base = await getServerBaseUrl();
        const el = document.getElementById("embed-status-ui-" + project);
        if (!base) {
          if (el)
            el.innerHTML =
              '<span class="status-indicator error">Server not detected</span>';
          return;
        }

        try {
          if (el)
            el.innerHTML =
              '<span class="status-indicator info">Checking...</span>';
          const resp = await fetch(
            base + "/api/embed/status?project=" + encodeURIComponent(project)
          );
          if (!resp.ok) throw new Error("HTTP " + resp.status);
          const data = await resp.json();

          if (data && data.exists && data.meta) {
            const m = data.meta;
            const built = m.builtAt
              ? new Date(m.builtAt).toLocaleString()
              : "unknown";
            if (el) {
              el.innerHTML = `
                <div class="status">
                  <div><strong>Built:</strong> ${built}</div>
                  <div><strong>Vectors:</strong> ${m.vectorCount}</div>
                  <div><strong>Model:</strong> ${m.model}</div>
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: ${Math.min(
                      100,
                      m.vectorCount / 100
                    )}%"></div>
                  </div>
                </div>
              `;
            }
          } else {
            if (el)
              el.innerHTML =
                '<span class="status-indicator warning">Index not built. Click Reindex.</span>';
          }
        } catch (e) {
          if (el)
            el.innerHTML =
              '<span class="status-indicator error">Status check failed: ' +
              (e.message || e) +
              "</span>";
        }
      }

      async function reindexProjectUi(project, buttonEl) {
        const base = await getServerBaseUrl();
        const el = document.getElementById("embed-status-ui-" + project);
        if (!base) {
          if (el)
            el.innerHTML =
              '<span class="status-indicator error">Server not detected</span>';
          return;
        }

        const original = buttonEl ? buttonEl.innerHTML : null;
        if (buttonEl) {
          buttonEl.disabled = true;
          buttonEl.innerHTML = "<i>↺</i> Rebuilding...";
        }

        if (el)
          el.innerHTML =
            '<span class="status-indicator info">Rebuilding...</span>';

        try {
          const resp = await fetch(base + "/api/embed/reindex", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ project }),
          });

          if (!resp.ok) throw new Error("HTTP " + resp.status);
          const data = await resp.json();

          if (data && data.meta) {
            const m = data.meta;
            const built = m.builtAt
              ? new Date(m.builtAt).toLocaleString()
              : "unknown";
            if (el) {
              el.innerHTML = `
                <div class="status">
                  <div><strong>Completed:</strong> ${built}</div>
                  <div><strong>Vectors:</strong> ${m.vectorCount}</div>
                  <div><strong>Model:</strong> ${m.model}</div>
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: ${Math.min(
                      100,
                      m.vectorCount / 100
                    )}%"></div>
                  </div>
                </div>
              `;
            }
          } else {
            if (el)
              el.innerHTML =
                '<span class="status-indicator warning">Rebuild complete, but no metadata returned</span>';
          }
        } catch (e) {
          if (el)
            el.innerHTML =
              '<span class="status-indicator error">Rebuild failed: ' +
              (e.message || e) +
              "</span>";
        } finally {
          if (buttonEl) {
            buttonEl.disabled = false;
            buttonEl.innerHTML = original || "<i>↺</i> Reindex";
          }
        }
      }

      function validateProjectsJson(text) {
        try {
          const parsed = JSON.parse(text);
          if (!parsed || typeof parsed !== "object")
            return { ok: false, error: "Root must be an object" };
          if (!parsed.projects || typeof parsed.projects !== "object")
            return { ok: false, error: "Missing required 'projects' object" };
          // optional defaultProject if present must be string
          if (
            parsed.defaultProject !== undefined &&
            typeof parsed.defaultProject !== "string"
          )
            return {
              ok: false,
              error: "'defaultProject' must be a string if provided",
            };

          // Additional validation for project structure (less strict)
          const projectNames = Object.keys(parsed.projects);
          for (const projectName of projectNames) {
            const project = parsed.projects[projectName];
            if (project.config && typeof project.config !== "object") {
              return {
                ok: false,
                error:
                  "Project '" + projectName + "' has invalid 'config' object",
              };
            }
          }

          return { ok: true };
        } catch (e) {
          return { ok: false, error: e.message || "Invalid JSON" };
        }
      }

      function updateEditorValidation() {
        const ta = document.getElementById("projects");
        const container = document.getElementById("config-editor-pane");
        const btn = document.getElementById("btn-save-config");
        const text = getProjectsText();
        const result = validateProjectsJson(text || "");
        if (result.ok) {
          if (ta) ta.classList.remove("invalid");
          if (container) container.classList.remove("editor-invalid");
          if (btn) btn.disabled = false;
          setStatus("✅ JSON is valid. Ready to save.", "success");
        } else {
          if (ta) ta.classList.add("invalid");
          if (container) container.classList.add("editor-invalid");
          if (btn) btn.disabled = true;
          setStatus("❌ " + result.error, "error");
        }
      }

      async function saveConfig() {
        try {
          const text = getProjectsText();
          const result = validateProjectsJson(text);
          if (!result.ok) {
            setStatus("❌ " + result.error, "error");
            updateEditorValidation();
            return;
          }
          const parsed = JSON.parse(text);
          const res = await fetch("/save", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(parsed),
          });
          if (!res.ok) throw new Error("Save failed");
          setStatus("✅ Saved projects.json successfully!", "success");

          // Refresh embeddings UI if on that tab
          if (activeTab === "embed") {
            loadEmbeddingsUi();
          }

          // Show a temporary success indicator
          const saveBtn = document.getElementById("btn-save-config");
          const originalText = saveBtn.innerHTML;
          saveBtn.innerHTML = "✅ Saved!";
          saveBtn.classList.add("secondary");
          setTimeout(() => {
            saveBtn.innerHTML = originalText;
            saveBtn.classList.remove("secondary");
          }, 2000);
        } catch (e) {
          setStatus("❌ Save failed: " + e.message, "error");
        }
      }

      // Enhanced UI functions for better user experience
      function highlightConfigGuide() {
        // Add visual feedback when user is editing
        const ta = document.getElementById("projects");
        if (!ta) return;

        ta.addEventListener("focus", () => {
          const guide = document.getElementById("config-guide");
          if (guide) {
            guide.style.boxShadow = "0 0 0 2px var(--accent-primary)";
            setTimeout(() => {
              guide.style.boxShadow = "none";
            }, 1000);
          }
        });
      }

      function addConfigTooltips() {
        // Tooltips for new reference items
        const refItems = document.querySelectorAll(".ref-item");
        refItems.forEach((item) => {
          try {
            const key = item.querySelector(".ref-key")?.textContent || "";
            const desc = item.querySelector(".ref-desc")?.textContent || "";
            if (key || desc) {
              item.title = key + (desc ? ": " + desc : "");
              item.style.cursor = "help";
            }
          } catch {}
        });
      }

      function setupConfigSearch() {
        const searchInput = document.getElementById("config-search");
        const clearButton = document.getElementById("clear-search");
        const refContainer = document.querySelector(".ref-panel");

        if (!searchInput) return;

        searchInput.addEventListener("input", () => {
          const searchTerm = searchInput.value.toLowerCase();

          // Show/hide clear button
          clearButton.style.display = searchTerm ? "block" : "none";

          // Filter reference items
          const items = document.querySelectorAll(".ref-item");
          const sections = document.querySelectorAll(".ref-section");
          items.forEach((item) => {
            const key = (
              item.querySelector(".ref-key")?.textContent || ""
            ).toLowerCase();
            const desc = (
              item.querySelector(".ref-desc")?.textContent || ""
            ).toLowerCase();
            const example = (
              item.querySelector(".ref-example")?.textContent || ""
            ).toLowerCase();
            const matches =
              key.includes(searchTerm) ||
              desc.includes(searchTerm) ||
              example.includes(searchTerm);
            item.style.display = matches ? "block" : "none";
          });
          // Hide sections with no visible items
          sections.forEach((section) => {
            const visible = Array.from(
              section.querySelectorAll(".ref-item")
            ).some((it) => it.style.display !== "none");
            section.style.display = visible ? "block" : "none";
          });
        });

        // Clear search
        clearButton.addEventListener("click", () => {
          searchInput.value = "";
          clearButton.style.display = "none";
          document
            .querySelectorAll(".ref-item")
            .forEach((it) => (it.style.display = "block"));
          document
            .querySelectorAll(".ref-section")
            .forEach((s) => (s.style.display = "block"));
          searchInput.focus();
        });
      }

      async function finish() {
        await saveConfig();
        setStatus("Shutting down setup server...", "info");
        try {
          await fetch("/shutdown", { method: "POST" });
        } catch {}
        // Try to close this tab/window; fallback to about:blank
        try {
          window.open("", "_self");
          window.close();
        } catch {}
        setTimeout(() => {
          try {
            window.location.replace("about:blank");
          } catch {}
        }, 600);
      }

      async function refreshInfo() {
        try {
          const res = await fetch("/server/info");
          const info = await res.json();
          const el = document.getElementById("server-status");
          const linkHealth = document.getElementById("btn-open-health");
          const linkId = document.getElementById("btn-open-id");
          const managedNote = document.getElementById("server-managed-note");

          if (info.port) {
            linkHealth.dataset.href =
              "http://127.0.0.1:" + info.port + "/connection-health";
            linkId.dataset.href =
              "http://127.0.0.1:" + info.port + "/.identity";
          }

          if (info.running) {
            if (el)
              el.innerHTML =
                '<span class="status-indicator ok">Running</span> <span class="badge">PID ' +
                (info.pid || "unknown") +
                '</span> <span class="badge">port ' +
                (info.port || "?") +
                "</span>";
            if (managedNote)
              managedNote.textContent =
                "Managed externally or by main process.";
          } else {
            if (el)
              el.innerHTML = AFBT_LAUNCHED_BY_MAIN
                ? '<span class="status-indicator info">Detecting...</span>'
                : '<span class="status-indicator error">Stopped</span>';
            if (managedNote) managedNote.textContent = "Not running.";
          }
        } catch {}
      }

      async function refreshDashboard() {
        // Refresh all dashboard information
        await refreshInfo();

        // Check Chrome extension status
        const extStatus = document.getElementById("extension-status");
        if (extStatus) {
          // In a real implementation, we would check the extension status
          // For now, we'll just show a placeholder
          extStatus.innerHTML =
            '<span class="status-indicator info">Status check not implemented</span>';
        }

        // Check configuration status
        const configStatus = document.getElementById("config-status");
        if (configStatus) {
          try {
            const res = await fetch("/config");
            if (res.ok) {
              const json = await res.json();
              if (
                json &&
                json.projects &&
                Object.keys(json.projects).length > 0
              ) {
                configStatus.innerHTML =
                  '<span class="status-indicator ok">' +
                  Object.keys(json.projects).length +
                  " project(s) configured</span>";
              } else {
                configStatus.innerHTML =
                  '<span class="status-indicator warning">No projects configured</span>';
              }
            } else {
              configStatus.innerHTML =
                '<span class="status-indicator error">Configuration not found</span>';
            }
          } catch {
            configStatus.innerHTML =
              '<span class="status-indicator error">Configuration check failed</span>';
          }
        }
      }

      async function openHealth() {
        try {
          const res = await fetch("/server/info");
          const info = await res.json();
          const href = document.getElementById("btn-open-health").dataset.href;
          if (info.port && href) {
            window.open(href, "_blank");
          } else {
            setStatus(
              "Connector not detected yet. Try again in a moment.",
              "warning"
            );
          }
        } catch {
          setStatus("Unable to open health endpoint.", "error");
        }
      }

      async function openIdentity() {
        try {
          const res = await fetch("/server/info");
          const info = await res.json();
          const href = document.getElementById("btn-open-id").dataset.href;
          if (info.port && href) {
            window.open(href, "_blank");
          } else {
            setStatus(
              "Connector not detected yet. Try again in a moment.",
              "warning"
            );
          }
        } catch {
          setStatus("Unable to open identity endpoint.", "error");
        }
      }

      async function loadDocs() {
        const listEl = document.getElementById("docs-items");
        if (!listEl) return;

        if (listEl.dataset.loaded === "1") return; // one-time
        listEl.innerHTML = '<div class="hint">Loading documentation...</div>';

        try {
          const res = await fetch("/docs/list");
          const files = await res.json();
          DOCS_FILES = files.slice();
          renderDocsList("");
          listEl.dataset.loaded = "1";
        } catch (e) {
          listEl.innerHTML =
            '<div class="error">Failed to load documentation: ' +
            (e.message || e) +
            "</div>";
        }
      }

      function copyFromElement(id) {
        try {
          const el = document.getElementById(id);
          if (!el) return;
          const text = el.innerText || el.textContent || "";
          navigator.clipboard.writeText(text);
          setStatus("✅ Copied to clipboard!", "success");

          // Provide visual feedback on the button
          const buttons = document.querySelectorAll(
            'button[onclick*="' + id + '"]'
          );
          buttons.forEach((button) => {
            const originalText = button.innerHTML;
            button.innerHTML = "✅ Copied!";
            button.classList.add("secondary");
            setTimeout(() => {
              button.innerHTML = originalText;
              button.classList.remove("secondary");
            }, 2000);
          });

          setTimeout(() => setStatus("", ""), 2000);
        } catch (e) {
          setStatus("❌ Copy failed: " + (e.message || e), "error");
        }
      }

      function renderDocsList(query) {
        const listEl = document.getElementById("docs-items");
        if (!listEl) return;

        const q = (query || "").toLowerCase();
        const prioritized = (p) => {
          if (p === "README.md") return "0";
          if (p.includes("PROJECT_OVERVIEW")) return "1";
          if (p.includes("SETUP_GUIDE")) return "2";
          if (p.includes("HOW_TO_USE")) return "3";
          return "9" + p;
        };

        const filtered = DOCS_FILES.filter((p) =>
          p.toLowerCase().includes(q)
        ).sort((a, b) => prioritized(a).localeCompare(prioritized(b)));

        listEl.innerHTML = "";
        filtered.forEach((p) => {
          const div = document.createElement("div");
          div.className = "file";
          div.title = p;
          div.textContent = p;
          div.onclick = () => loadDoc(p);
          listEl.appendChild(div);
        });

        const counter = document.getElementById("docs-count");
        if (counter)
          counter.textContent =
            filtered.length + "/" + DOCS_FILES.length + " files";
      }

      async function loadDoc(p) {
        const titleEl = document.getElementById("doc-title");
        const viewEl = document.getElementById("docs-view");

        if (titleEl) titleEl.textContent = "Loading...";
        if (viewEl)
          viewEl.innerHTML = '<div class="hint">Loading document...</div>';

        try {
          const res = await fetch(
            "/docs/content?path=" + encodeURIComponent(p)
          );
          const txt = await res.text();
          const md = window.markdownit({
            html: false,
            linkify: true,
            breaks: true,
          });

          if (titleEl) titleEl.textContent = p;
          if (viewEl) viewEl.innerHTML = md.render(txt);
        } catch (e) {
          if (viewEl)
            viewEl.innerHTML =
              '<div class="error">Failed to load document: ' +
              (e.message || e) +
              "</div>";
        }
      }

      async function reloadEnv() {
        try {
          const res = await fetch("/env");
          const data = await res.json();
          const envText = document.getElementById("envText");
          if (envText) envText.value = data.content || "";
          const envPathHint = document.getElementById("envPathHint");
          if (envPathHint) envPathHint.textContent = data.path || ".env";
        } catch {
          /* ignore */
        }
      }

      async function saveEnv() {
        try {
          const content = document.getElementById("envText").value;
          // Include the current path so we overwrite the same file we loaded
          const info = await (await fetch("/env")).json();
          const res = await fetch("/env", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ content, path: info.path }),
          });
          if (!res.ok) throw new Error("Save .env failed");

          const envStatus = document.getElementById("envStatus");
          if (envStatus) {
            envStatus.textContent = "Saved .env successfully.";
            envStatus.className = "hint success";
            try {
              clearTimeout(window.__afbtEnvStatusTimer);
            } catch {}
            window.__afbtEnvStatusTimer = setTimeout(() => {
              try {
                envStatus.textContent = "";
                envStatus.className = "hint";
              } catch {}
            }, 2500);
          } else {
            setStatus("Saved .env successfully.", "success");
          }
        } catch (e) {
          const envStatus = document.getElementById("envStatus");
          if (envStatus) {
            envStatus.textContent = "Failed to save .env: " + e.message;
            envStatus.className = "hint error";
          } else {
            setStatus("Failed to save .env: " + e.message, "error");
          }
        }
      }

      window.addEventListener("DOMContentLoaded", async () => {
        try {
          await loadConfig();
        } catch {}

        showTab("dashboard");

        // Ensure active state in nav for first paint
        try {
          document.getElementById("tab-dashboard").classList.add("active");
        } catch {}

        // compute dynamic header/footer heights for perfect fit
        function adjustLayout() {
          const headerH = document.querySelector("header")?.offsetHeight || 70;
          const footerH = document.querySelector("footer")?.offsetHeight || 45;
          document.documentElement.style.setProperty(
            "--header-h",
            headerH + "px"
          );
          document.documentElement.style.setProperty(
            "--footer-h",
            footerH + "px"
          );
        }

        adjustLayout();
        window.addEventListener("resize", adjustLayout);

        // Short polling to avoid initial detection race when main is launching server
        let tries = 0;
        const t = setInterval(async () => {
          tries++;
          await refreshInfo();
          if (tries >= 8) clearInterval(t);
        }, 1200);

        const search = document.getElementById("docs-search");
        if (search)
          search.addEventListener("input", (e) =>
            renderDocsList(e.target.value)
          );

        // Initialize Monaco JSON editor (with textarea fallback)
        (function initMonaco() {
          const host = document.getElementById("projects-editor");
          const ta = document.getElementById("projects");
          if (!host) return;
          if (window.require) {
            window.require.config({
              paths: {
                vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs",
              },
            });
            window.require(["vs/editor/editor.main"], function () {
              try {
                const initial = ta ? ta.value || "" : "";
                projectsEditor = monaco.editor.create(host, {
                  value: initial,
                  language: "json",
                  theme: "vs-dark",
                  automaticLayout: true,
                  scrollBeyondLastLine: false,
                  wordWrap: "on",
                  minimap: { enabled: false },
                  tabSize: 2,
                });
                // Hide textarea fallback once Monaco is ready
                if (ta) ta.style.display = "none";
                // Validate as user types
                projectsEditor.onDidChangeModelContent(() => {
                  updateEditorValidation();
                  debouncedRender();
                });
                updateEditorValidation();
                renderSidebarFromEditor();
              } catch (_) {}
            });
          }
        })();

        // Live JSON validation for textarea fallback
        const ta = document.getElementById("projects");
        if (ta) {
          ta.addEventListener("input", () => {
            updateEditorValidation();
            debouncedRender();
          });
          updateEditorValidation();
          highlightConfigGuide();
        }

        // Bind new sidebar form interactions
        bindFormInputs();
        bindProjectActions();

        // Initialize reference panel helpers after DOM exists
        addConfigTooltips();
        setupConfigSearch();
      });
    </script>
  </head>
  <body>
    <header>
      <h1>Autonomous Frontend Browser Tools</h1>
      <nav>
        <button id="tab-dashboard" onclick="showTab('dashboard')">
          Dashboard
        </button>
        <button id="tab-configure" onclick="showTab('configure')">
          Projects
        </button>
        <button id="tab-env" onclick="showTab('env')">Environment</button>
        <button id="tab-embed" onclick="showTab('embed')">Embeddings</button>
        <button id="tab-examples" onclick="showTab('examples')">
          Examples
        </button>
        <button id="tab-docs" onclick="showTab('docs')">Docs</button>
      </nav>
      <div class="top-actions">
        <a
          id="btn-open-health"
          class="action-button"
          href="javascript:void(0)"
          onclick="openHealth()"
        >
          <i>❤️</i> Health
        </a>
        <a
          id="btn-open-id"
          class="action-button"
          href="javascript:void(0)"
          onclick="openIdentity()"
        >
          <i>🆔</i> Identity
        </a>
        <button
          id="btn-close-ui"
          class="action-button primary"
          onclick="finish()"
        >
          <i>✅</i> Finish
        </button>
      </div>
    </header>
    <main>
      <!-- Dashboard Section -->
      <section id="section-dashboard" class="section" style="display: none">
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <h3><i>🌐</i> Chrome Extension</h3>
            <div class="status">
              <div id="extension-status">
                <span class="status-indicator info">Checking...</span>
              </div>
              <div class="hint small">
                Load via chrome://extensions → Developer Mode → Load unpacked →
                select <code>chrome-extension/</code>.
              </div>
              <div class="hint small" style="margin-top: 8px">
                Keep DevTools open on the active tab when using browser/ui
                tools.
              </div>
            </div>
          </div>
          <div class="dashboard-card">
            <h3><i>🔌</i> Connector Server</h3>
            <div class="status">
              <div id="server-status">
                <span class="status-indicator info">Detecting...</span>
              </div>
              <div class="hint small">
                Health endpoint exposes heartbeat, uptime, pending operations.
              </div>
              <div
                id="server-managed-note"
                class="hint small"
                style="margin-top: 8px"
              ></div>
            </div>
          </div>
          <div class="dashboard-card">
            <h3><i>⚙️</i> Configuration</h3>
            <div class="status">
              <div id="config-status">
                <span class="status-indicator info">Checking...</span>
              </div>
              <div class="hint small">Project configuration status.</div>
            </div>
          </div>
        </div>
        <div class="card">
          <h3><i>⚡</i> Quick Actions</h3>
          <div class="actions">
            <button onclick="showTab('configure')">Configure Projects</button>
            <button onclick="showTab('env')">Set Environment</button>
            <button onclick="showTab('embed')">Manage Embeddings</button>
            <button onclick="showTab('docs')">View Documentation</button>
          </div>
        </div>
      </section>

      <!-- Configure Section -->
      <section id="section-configure" class="section" style="display: none">
        <div class="split">
          <div class="left" id="config-guide">
            <div class="sidebar-header">
              <h3 style="margin: 0"><i>📁</i> Projects</h3>
              <span class="sidebar-subtle">Manage and configure</span>
            </div>

            <div class="project-controls">
              <input
                id="project-add-input"
                class="config-search-input"
                placeholder="New project name"
              />
              <button id="btn-project-add" class="small-btn">Add</button>
            </div>

            <div id="project-list" class="project-list"></div>

            <div class="sidebar-header" style="margin-top: 8px">
              <h4 style="margin: 0">
                Selected: <span id="current-project-label">None</span>
              </h4>
            </div>
            <div
              id="selected-project-actions"
              class="inline-actions"
              style="display: none"
            >
              <button id="btn-set-default" class="small-btn">
                Set as default
              </button>
              <button id="btn-rename-project" class="small-btn">Rename</button>
              <button id="btn-delete-project" class="small-btn">Delete</button>
            </div>

            <div id="project-form" style="display: none">
              <div class="section-title">Essentials</div>
              <div class="two-col">
                <div class="form-group">
                  <label for="fld-SWAGGER_URL">SWAGGER_URL</label>
                  <input
                    id="fld-SWAGGER_URL"
                    type="text"
                    placeholder="https://api.example.com/openapi.json"
                  />
                  <div class="hint small">
                    Powers api.searchEndpoints and embeddings
                  </div>
                </div>
                <div class="form-group">
                  <label for="fld-API_BASE_URL">API_BASE_URL</label>
                  <input
                    id="fld-API_BASE_URL"
                    type="text"
                    placeholder="https://api.example.com"
                  />
                  <div class="hint small">Used by api.request</div>
                </div>
              </div>

              <div class="section-title">Authentication</div>
              <div class="two-col">
                <div class="form-group">
                  <label for="fld-AUTH_STORAGE_TYPE">AUTH_STORAGE_TYPE</label>
                  <select id="fld-AUTH_STORAGE_TYPE">
                    <option value="">(none)</option>
                    <option value="localStorage">localStorage</option>
                    <option value="sessionStorage">sessionStorage</option>
                    <option value="cookies">cookies</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="fld-AUTH_TOKEN_KEY">AUTH_TOKEN_KEY</label>
                  <input
                    id="fld-AUTH_TOKEN_KEY"
                    type="text"
                    placeholder="access_token"
                  />
                </div>
                <div class="form-group">
                  <label for="fld-AUTH_ORIGIN">AUTH_ORIGIN</label>
                  <input
                    id="fld-AUTH_ORIGIN"
                    type="text"
                    placeholder="https://staging.example.com"
                  />
                </div>
                <div class="form-group">
                  <label for="fld-API_AUTH_TOKEN_TTL_SECONDS"
                    >API_AUTH_TOKEN_TTL_SECONDS</label
                  >
                  <input
                    id="fld-API_AUTH_TOKEN_TTL_SECONDS"
                    type="number"
                    placeholder="3600"
                  />
                </div>
              </div>

              <div class="section-title">Navigation</div>
              <div class="form-group">
                <label for="fld-ROUTES_FILE_PATH">ROUTES_FILE_PATH</label>
                <input
                  id="fld-ROUTES_FILE_PATH"
                  type="text"
                  placeholder="src/routes/paths.ts"
                />
              </div>

              <div class="section-title">Screenshots</div>
              <div class="two-col">
                <div class="form-group">
                  <label for="fld-SCREENSHOT_STORAGE_PATH"
                    >SCREENSHOT_STORAGE_PATH (per-project)</label
                  >
                  <input
                    id="fld-SCREENSHOT_STORAGE_PATH"
                    type="text"
                    placeholder="/path/to/project/screenshots"
                  />
                </div>
                <div class="form-group">
                  <label for="fld-DEFAULT_SCREENSHOT_STORAGE_PATH"
                    >DEFAULT_SCREENSHOT_STORAGE_PATH (global)</label
                  >
                  <input
                    id="fld-DEFAULT_SCREENSHOT_STORAGE_PATH"
                    type="text"
                    placeholder="/path/to/all/screenshots"
                  />
                </div>
              </div>
            </div>

            <div class="section-title">Reference</div>
            <div class="reference">
              <details open>
                <summary>Configuration Guide</summary>
                <div class="hint" style="padding: 10px 12px">
                  This file is local and intended to be ignored by git.
                </div>
                <div
                  class="config-search-container"
                  style="padding: 0 12px 12px 12px"
                >
                  <input
                    type="text"
                    id="config-search"
                    placeholder="Search configuration options..."
                    class="config-search-input"
                  />
                  <button
                    id="clear-search"
                    class="clear-search-btn"
                    style="display: none"
                  >
                    ×
                  </button>
                </div>

                <div class="ref-panel">
                  <div class="ref-section">
                    <div class="ref-header">
                      <h4>🔑 Required</h4>
                      <span class="hint small">Start here</span>
                    </div>
                    <div class="ref-items">
                      <div class="ref-item" data-key="SWAGGER_URL">
                        <div class="ref-top">
                          <div class="ref-key">SWAGGER_URL</div>
                          <div class="ref-chips">
                            <span class="chip chip-required">Required</span>
                            <span class="chip chip-primary"
                              >api.searchEndpoints</span
                            >
                            <span class="chip chip-primary">api.listTags</span>
                          </div>
                        </div>
                        <div class="ref-desc">
                          URL or file path to your OpenAPI/Swagger specification
                          (per project). Required to build and query embeddings.
                        </div>
                        <div class="ref-example">
                          Example: https://api.example.com/openapi.json
                        </div>
                      </div>
                      <div class="ref-item" data-key="API_BASE_URL">
                        <div class="ref-top">
                          <div class="ref-key">API_BASE_URL</div>
                          <div class="ref-chips">
                            <span class="chip chip-required">Required</span>
                            <span class="chip chip-primary">api.request</span>
                          </div>
                        </div>
                        <div class="ref-desc">
                          Base URL used to make live API requests. The endpoint
                          path from Swagger is appended when testing via
                          api.request.
                        </div>
                        <div class="ref-example">
                          Example: https://api.example.com
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="ref-section">
                    <div class="ref-header">
                      <h4>🔐 Authentication</h4>
                      <span class="hint small">Configure token retrieval</span>
                    </div>
                    <div class="ref-items">
                      <div class="ref-item" data-key="AUTH_STORAGE_TYPE">
                        <div class="ref-top">
                          <div class="ref-key">AUTH_STORAGE_TYPE</div>
                          <div class="ref-chips">
                            <span class="chip chip-optional">Optional</span>
                            <span class="chip chip-primary">api.request</span>
                          </div>
                        </div>
                        <div class="ref-desc">
                          Where the auth token is stored in the browser. Enables
                          adding Authorization: Bearer automatically when
                          includeAuthToken is true.
                        </div>
                        <div class="ref-example">
                          Values: localStorage, sessionStorage, cookies
                        </div>
                      </div>
                      <div class="ref-item" data-key="AUTH_TOKEN_KEY">
                        <div class="ref-top">
                          <div class="ref-key">AUTH_TOKEN_KEY</div>
                          <div class="ref-chips">
                            <span class="chip chip-optional">Optional</span>
                            <span class="chip chip-primary">api.request</span>
                          </div>
                        </div>
                        <div class="ref-desc">
                          Storage key (or cookie name) used to read the bearer
                          token.
                        </div>
                        <div class="ref-example">
                          Example: access_token, auth_token
                        </div>
                      </div>
                      <div class="ref-item" data-key="AUTH_ORIGIN">
                        <div class="ref-top">
                          <div class="ref-key">AUTH_ORIGIN</div>
                          <div class="ref-chips">
                            <span class="chip chip-optional">Optional</span>
                            <span class="chip chip-primary"
                              >api.request (cookies)</span
                            >
                          </div>
                        </div>
                        <div class="ref-desc">
                          Required when tokens are cookies: browser origin to
                          read cookies from.
                        </div>
                        <div class="ref-example">
                          Example: https://staging.example.com
                        </div>
                      </div>
                      <div
                        class="ref-item"
                        data-key="API_AUTH_TOKEN_TTL_SECONDS"
                      >
                        <div class="ref-top">
                          <div class="ref-key">API_AUTH_TOKEN_TTL_SECONDS</div>
                          <div class="ref-chips">
                            <span class="chip chip-optional">Optional</span>
                            <span class="chip chip-primary"
                              >api.request (auth cache)</span
                            >
                          </div>
                        </div>
                        <div class="ref-desc">
                          TTL for token cache (seconds). Overrides JWT exp-based
                          caching if set.
                        </div>
                        <div class="ref-example">Example: 3600</div>
                      </div>
                    </div>
                  </div>

                  <div class="ref-section">
                    <div class="ref-header">
                      <h4>🧭 Navigation</h4>
                      <span class="hint small">Optional routing hints</span>
                    </div>
                    <div class="ref-items">
                      <div class="ref-item" data-key="ROUTES_FILE_PATH">
                        <div class="ref-top">
                          <div class="ref-key">ROUTES_FILE_PATH</div>
                          <div class="ref-chips">
                            <span class="chip chip-optional">Optional</span>
                            <span class="chip chip-success"
                              >browser.navigate</span
                            >
                          </div>
                        </div>
                        <div class="ref-desc">
                          Path hint to your app's route definitions to improve
                          descriptions.
                        </div>
                        <div class="ref-example">
                          Example: src/routes/paths.ts
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="ref-section">
                    <div class="ref-header">
                      <h4>📸 Screenshots</h4>
                      <span class="hint small">Storage locations</span>
                    </div>
                    <div class="ref-items">
                      <div class="ref-item" data-key="SCREENSHOT_STORAGE_PATH">
                        <div class="ref-top">
                          <div class="ref-key">SCREENSHOT_STORAGE_PATH</div>
                          <div class="ref-chips">
                            <span class="chip chip-optional">Optional</span>
                            <span class="chip chip-success"
                              >browser.screenshot</span
                            >
                          </div>
                        </div>
                        <div class="ref-desc">
                          Per-project directory used by the screenshot service
                          to save images.
                        </div>
                        <div class="ref-example">
                          Example: /path/to/project/screenshots
                        </div>
                      </div>
                      <div
                        class="ref-item"
                        data-key="DEFAULT_SCREENSHOT_STORAGE_PATH"
                      >
                        <div class="ref-top">
                          <div class="ref-key">
                            DEFAULT_SCREENSHOT_STORAGE_PATH
                          </div>
                          <div class="ref-chips">
                            <span class="chip chip-optional">Optional</span>
                            <span class="chip chip-success"
                              >browser.screenshot</span
                            >
                          </div>
                        </div>
                        <div class="ref-desc">
                          Top-level default base directory for screenshots when
                          per-project path is not set.
                        </div>
                        <div class="ref-example">
                          Example: /path/to/all/screenshots
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="ref-section">
                    <div class="ref-header">
                      <h4>⚙️ Internal</h4>
                      <span class="hint small">Advanced and defaults</span>
                    </div>
                    <div class="ref-items">
                      <div class="ref-item" data-key="BROWSER_TOOLS_HOST">
                        <div class="ref-top">
                          <div class="ref-key">BROWSER_TOOLS_HOST</div>
                          <div class="ref-chips">
                            <span class="chip chip-secondary">Internal</span>
                          </div>
                        </div>
                        <div class="ref-desc">Override connector host.</div>
                        <div class="ref-example">Default: 127.0.0.1</div>
                      </div>
                      <div class="ref-item" data-key="BROWSER_TOOLS_PORT">
                        <div class="ref-top">
                          <div class="ref-key">BROWSER_TOOLS_PORT</div>
                          <div class="ref-chips">
                            <span class="chip chip-secondary">Internal</span>
                          </div>
                        </div>
                        <div class="ref-desc">Override connector port.</div>
                        <div class="ref-example">Default: 3025</div>
                      </div>
                      <div class="ref-item" data-key="defaultProject">
                        <div class="ref-top">
                          <div class="ref-key">defaultProject</div>
                          <div class="ref-chips">
                            <span class="chip chip-secondary">All tools</span>
                          </div>
                        </div>
                        <div class="ref-desc">
                          Fallback active project when not set via environment
                          or header.
                        </div>
                        <div class="ref-example">Example: my-frontend</div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="config-note">
                  <div class="hint small">
                    <i>💡</i> <strong>Tip:</strong> Set
                    <code>defaultProject</code> to the project you work with
                    most.
                  </div>
                  <div class="hint small">
                    <i>🔑</i> <strong>API Keys:</strong> Embedding provider keys
                    (<code>OPENAI_API_KEY</code>, <code>GEMINI_API_KEY</code>)
                    are set in the Environment tab.
                  </div>
                </div>
              </details>
            </div>
          </div>
          <div class="right" id="config-editor-pane">
            <div class="editor-header">
              <h3><i>📝</i> Configuration Editor</h3>
              <p>
                Edit your per-project configuration below. When finished, click
                "Save Configuration".
              </p>
            </div>
            <div class="editor-container">
              <!-- Monaco host; will fill available space -->
              <div id="projects-editor"></div>
              <!-- Fallback textarea (hidden when Monaco loads) -->
              <textarea
                id="projects"
                spellcheck="false"
                class="config-textarea"
                style="display: none"
              ></textarea>
            </div>
            <div class="actions">
              <button id="btn-save-config" onclick="saveConfig()">
                Save Configuration
              </button>
              <button class="secondary" onclick="loadConfig()">Reload</button>
              <button
                class="secondary"
                onclick="(async ()=>{ try { const text = getProjectsText(); const parsed = JSON.parse(text); setProjectsText(JSON.stringify(parsed, null, 2)); setStatus('Formatted JSON.', 'success'); updateEditorValidation(); } catch(e){ setStatus('❌ Cannot format: ' + (e.message||e), 'error'); } })()"
              >
                Format JSON
              </button>
              <button onclick="showTab('examples')">View Examples</button>
            </div>
            <div id="status" class="hint"></div>
            <div class="hint">Path: projects.json (project root)</div>
            <div class="hint" style="margin-top: 12px">
              Run this UI directly with <code>pnpm run setup:ui</code> or
              implicitly via <code>pnpm run setup</code>.
            </div>
          </div>
        </div>
      </section>

      <!-- Environment Section -->
      <section id="section-env" class="section" style="display: none">
        <div class="split">
          <div class="left" id="env-guide">
            <h3><i>🌍</i> Environment Variables</h3>
            <div class="hint" style="margin-top: 8px">
              Embedding provider API keys configured here are used to build and
              query the semantic index that powers
              <code>api.searchEndpoints</code> and other API documentation
              search features. Set one:
              <ul>
                <li>
                  <b>OPENAI_API_KEY</b> (+ optional
                  <code>OPENAI_EMBED_MODEL</code>)
                </li>
                <li>
                  <b>GEMINI_API_KEY</b> (+ optional
                  <code>GEMINI_EMBED_MODEL</code>)
                </li>
              </ul>
              If you change provider/model, reindex from the Embeddings tab.
            </div>
            <div class="hint" style="margin-top: 16px">
              <h4>Common Keys:</h4>
              <ul>
                <li>
                  <b>OPENAI_API_KEY</b> or <b>GEMINI_API_KEY</b> (embedding
                  provider)
                </li>
                <li><b>LOG_LEVEL</b>: error | warn | info | debug</li>
              </ul>
            </div>
          </div>
          <div class="right" id="env-editor-pane">
            <textarea id="envText" spellcheck="false"></textarea>
            <div class="actions">
              <button onclick="saveEnv()">Save Environment</button>
              <button class="secondary" onclick="reloadEnv()">Reload</button>
            </div>
            <div id="envStatus" class="hint"></div>
            <div class="hint small">
              Path: <span id="envPathHint">.env</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Embeddings Section -->
      <section id="section-embed" class="section" style="display: none">
        <div class="split">
          <div class="left" id="embed-guide">
            <h3><i>🧠</i> Embeddings Management</h3>
            <div class="hint">
              Manage semantic indexes for your API documentation. Status and
              reindexing are per project. The server must be running for these
              features to work.
            </div>
            <div class="hint" style="margin-top: 16px">
              <h4>How it works:</h4>
              <ul>
                <li>API documentation is parsed from your SWAGGER_URL</li>
                <li>Embeddings are created using your configured provider</li>
                <li>Semantic search is enabled for api.searchEndpoints</li>
                <li>Reindex when documentation or provider changes</li>
              </ul>
            </div>
          </div>
          <div class="right">
            <div id="embed-projects-list-ui"></div>
          </div>
        </div>
      </section>

      <!-- Examples Section -->
      <section id="section-examples" class="section" style="display: none">
        <div class="split">
          <div class="left">
            <h3><i>📝</i> Configuration Examples</h3>
            <div class="hint">
              Ready-to-use configuration examples for getting started quickly.
              Each example includes detailed descriptions and can be copied with
              one click.
            </div>
            <div class="hint" style="margin-top: 16px">
              <i>🚀</i> <strong>How to use:</strong>
              <ol style="margin: 8px 0; padding-left: 20px">
                <li>Choose the example that matches your needs</li>
                <li>Click the copy button to copy to clipboard</li>
                <li>Paste into the respective editor tab</li>
                <li>Customize the values for your project</li>
              </ol>
            </div>
          </div>
          <div class="right">
            <div class="examples-container">
              <div class="example-column">
                <div class="example-header">
                  <h4><i>📁</i> projects.json Configuration</h4>
                  <div class="hint small">
                    Multi-project setup with different authentication methods
                    (localStorage vs cookies) and environments
                  </div>
                </div>
                <pre class="example-code" id="example-projects-json">
{
  "projects": {
    "my-frontend": {
      "config": {
        "SWAGGER_URL": "https://api.example.com/openapi.json",
        "API_BASE_URL": "https://api.example.com",
        "AUTH_STORAGE_TYPE": "localStorage",
        "AUTH_TOKEN_KEY": "access_token",
        "AUTH_ORIGIN": "http://localhost:5173",
        "API_AUTH_TOKEN_TTL_SECONDS": 3300,
        "ROUTES_FILE_PATH": "src/routes/paths.ts"
      }
    },
    "another-frontend": {
      "config": {
        "SWAGGER_URL": "https://staging.example.com/openapi.json",
        "API_BASE_URL": "https://staging.example.com",
        "AUTH_STORAGE_TYPE": "cookies",
        "AUTH_TOKEN_KEY": "auth_token",
        "AUTH_ORIGIN": "https://staging.example.com",
        "API_AUTH_TOKEN_TTL_SECONDS": 1800,
        "ROUTES_FILE_PATH": "src/routes/paths.ts"
      }
    }
  },
  "defaultProject": "my-frontend",
  "DEFAULT_SCREENSHOT_STORAGE_PATH": "/absolute/path/to/screenshots/root"
}</pre
                >
                <div class="example-actions">
                  <button onclick="copyFromElement('example-projects-json')">
                    <i>📋</i> Copy projects.json
                  </button>
                </div>
              </div>

              <div class="example-column">
                <div class="example-header">
                  <h4><i>🔑</i> .env Environment Variables</h4>
                  <div class="hint small">
                    Configure your embedding provider API keys and optional
                    logging settings for the MCP tools
                  </div>
                </div>
                <pre class="example-code" id="example-env">
# Embedding provider keys (choose one)
OPENAI_API_KEY=your_openai_api_key_here
# OPENAI_EMBED_MODEL=text-embedding-3-large

# or
GEMINI_API_KEY=your_gemini_api_key_here
# GEMINI_EMBED_MODEL=text-embedding-004

# Optional logging level
LOG_LEVEL=info</pre
                >
                <div class="example-actions">
                  <button onclick="copyFromElement('example-env')">
                    <i>📋</i> Copy .env
                  </button>
                </div>
              </div>
            </div>

            <div class="example-note">
              <div class="hint">
                <i>💡</i> <strong>Quick Start:</strong> Click the copy buttons
                above, then paste into the respective editors in the Projects or
                Environment tabs. Customize the values for your specific setup.
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Docs Section -->
      <section id="section-docs" class="section" style="display: none">
        <div class="split">
          <div class="left" id="docs-pane">
            <input id="docs-search" placeholder="Search documentation..." />
            <div
              id="docs-count"
              class="hint small"
              style="margin-bottom: 8px"
            ></div>
            <div id="docs-items"></div>
          </div>
          <div class="right">
            <div class="hint" id="doc-title" style="margin-bottom: 12px">
              Select a document from the left
            </div>
            <div id="docs-view"></div>
          </div>
        </div>
      </section>
    </main>
    <footer>
      Autonomous Frontend Browser Tools — Enhanced Setup UI — Runs only for
      configuration; safe to close when done.
    </footer>
  </body>
</html>
